---
title: "Fargo_Crime_2017"
output: html_notebook
---

```{r, warning = F}
library(tidyverse)
library(ggmap)
library(lubridate)
library(ggthemes)
library(scales)
```


#### Upload Data

Try uploading test of the full data, not all lat/lon included
```{r}
full <- read.csv("crime.csv", header = T)
```

```{r}
str(full)
```
#### Data Wrangling

Convert "Date.Time" field into actual date field
```{r}
full$Date.Time <- lubridate::mdy(full$Date.Time)
```


Convert "Time" field into actual time field
```{r}
library(lubridate)

full$Time <- lubridate::mdy_hms(full$Time)

```


```{r}
str(full)
```


Drop the NA rows
```{r}
full <- tidyr::drop_na(data = full)
```

```{r}
str(full)
```


```{r}
head(full)
```

Recode the Call.Type to smaller groups
```{r}
full.recode <- dplyr::mutate(full, Category = recode(full$Call.Type,   # make new categories
                                                       "Abuse" = "Violent",
                                                       "Assault" = "Violent",
                                                       "Bicycle - Theft" = "Property",
                                                       "Bomb Threat" = "Violent",
                                                       "Burglary" = "Property",
                                                       "Death Notification" = "Violent",
                                                       "Domestic" = "Violent",
                                                       "Graffiti" = "Property",
                                                       "Gun Shots Heard" = "Violent",
                                                       "Harassment" = "Violent",
                                                       "Impaired Driver" = "Drugs/Alcohol",
                                                       "Impaired Person" = "Drugs/Alcohol",
                                                       "Kidnapping" = "Violent",
                                                       "Loud Party/People" = "Drugs/Alcohol",
                                                       "Overdose - Poisoning" = "Drugs/Alcohol",
                                                       "Prowler/Peeper" = "Violent",
                                                       "Robbery" = "Property", 
                                                       "Sexual Assault" = "Violent",
                                                       "Stab/Gunshot/Penetrating" = "Violent",
                                                       "Stolen Vehicle" = "Property",
                                                       "Theft" = "Property",
                                                       "Vandalism" = "Property",
                                                       "Vehicle Break In" = "Property"))


    ```

```{r}
library(ggradar)

suppressPackageStartupMessages(library(dplyr))
library(scales)
library(tibble)

 mtcars %>%
      rownames_to_column( var = "group" ) %>%
      mutate_at(vars(-group),funs(rescale)) %>%
      tail(4) %>% select(1:10) -> mtcars_radar
 mtcars_radar
#it <- data.frame(Value = c(12,34,6,7), Name = factor('hi','how','are','you'))
ggradar(mtcars_radar)
```

Mutate a new column with the hour the crime took place within
```{r}
full.spread <- dplyr::mutate(full, Time.Hour = hour(full$Time))
```




## 1. Crime category by time of day
```{r}

ggplot(full.recode, aes(x = Time)) + 
  geom_density(aes(fill = as.factor(Category),
                   colour = Category, y = ..density..),
               stat = "density",
               position = "identity",
               alpha = 0.4) + 
  theme_economist(base_size = 10) + 
  theme(text = element_text(family = "sans",
                          face = "plain",
                          color = "#000000",
                          size = 8,
                          hjust = 0.5,
                          vjust = 0.5)) + 
  guides(fill = guide_legend(title = "Category"), 
         colour = guide_legend(title = "Category"))  + 
  ylab("density") + 
  xlab("Time of Day") + 
  ggtitle("") +
  scale_x_datetime(labels = date_format("%H:%M")) + 
  theme(axis.text.y = element_blank()) 
scale_x_datetime()
ggsave(filename = "plot1.png")
```










Plot Calendar Heatmap
using ggTimeSeries

Wrangle data into occurences by day
```{r}
library(data.table)
calendar.data <- dplyr::add_count(full.recode, Date.Time)
calendar.data <- dplyr::arrange(calendar.data, Date.Time)

calendar.data <- calendar.data %>% 
  group_by(Date.Time) %>% 
  summarise(avg = mean(n))

# need to coerce to data.table
calendar.data <- data.table::data.table(Date = calendar.data$Date.Time,
                                        Crimes = calendar.data$avg)
```

Now we plot it
```{r}
library(viridis)
library(ggTimeSeries)



calendar.plot <- ggplot_calendar_heatmap(calendar.data,
                                         'Date',
                                         'Crimes') 
calendar.plot +
  xlab(NULL) +
  ylab(NULL) +
  scale_fill_viridis(alpha = 0.7)

```

```{r}
# order by month
full$Month <- factor(full$Month, c("Jan", "Feb", "Mar", "Apr", "May",
                                   "Jun", "Jul", "Aug", "Sep", "Oct",
                                   "Nov", "Dec"))

ggplot(data = full, aes(Month)) +
  geom_bar(stat = "count", fill = "indianred1", alpha = 0.7) +
  ggthemes::theme_economist(base_size = 10) 

#ggplot2::ggsave(filename = "plot2.jpg")
```

```{r}
# order by weekday
full$Weekday <- factor(full$Weekday, c("Sunday", "Monday", "Tuesday", "Wednesday",
                                       "Thursday","Friday", "Saturday"))

ggplot(data = full, aes(Weekday)) +
  geom_bar(stat = "count", fill = "indianred1", alpha = 0.7) +
  ggthemes::theme_economist(base_size = 10) 

#ggplot2::ggsave(filename = "plot3.jpg")
```

```{r}

```


